"use strict";function t(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var e=t(require("stream")),r=t(require("http")),n=t(require("url")),i=t(require("https")),o=t(require("zlib"));class s{constructor(t){this.view=new DataView(t)}length(){return this.view.byteLength}indexAt(t){return this.view.getUint8(t)}toArrayBuffer(){return this.view.buffer}serializeJson(){return"0x"+Array.prototype.map.call(new Uint8Array(this.view.buffer),t=>("00"+t.toString(16)).slice(-2)).join("")}}class a{constructor(t){this.string=t}length(){return this.string.length/2-1}indexAt(t){return parseInt(this.string.substr(2+2*t,2),16)}toArrayBuffer(){const t=new ArrayBuffer(this.length()),e=new DataView(t);for(let t=0;t<this.length();t++)e.setUint8(t,this.indexAt(t));return t}serializeJson(){return this.string}}class u{constructor(t){if(t instanceof a||t instanceof s)return t;if("string"==typeof t){if(!t.startsWith("0x")||t.length%2!=0)throw new Error("Hex string must start with 0x, and has even numbered length!");return new a(t)}if(t instanceof ArrayBuffer)return new s(t);throw new Error("Reader can only accept hex string or ArrayBuffer!")}static fromRawString(t){const e=new ArrayBuffer(t.length),r=new DataView(e);for(let e=0;e<t.length;e++){const n=t.charCodeAt(e);if(n>255)throw new Error("fromRawString can only accept UTF-8 raw string!");r.setUint8(e,n)}return new s(e)}}class l extends Array{constructor(t,e){if(t>l.__kMaxLength)throw new RangeError("Maximum BigInt size exceeded");super(t),this.sign=e}static BigInt(t){var e=Math.floor,r=Number.isFinite;if("number"==typeof t){if(0===t)return l.__zero();if((0|t)===t)return 0>t?l.__oneDigit(-t,!0):l.__oneDigit(t,!1);if(!r(t)||e(t)!==t)throw new RangeError("The number "+t+" cannot be converted to BigInt because it is not an integer");return l.__fromDouble(t)}if("string"==typeof t){const e=l.__fromString(t);if(null===e)throw new SyntaxError("Cannot convert "+t+" to a BigInt");return e}if("boolean"==typeof t)return!0===t?l.__oneDigit(1,!1):l.__zero();if("object"==typeof t){if(t.constructor===l)return t;const e=l.__toPrimitive(t);return l.BigInt(e)}throw new TypeError("Cannot convert "+t+" to a BigInt")}toDebugString(){const t=["BigInt["];for(const e of this)t.push((e?(e>>>0).toString(16):e)+", ");return t.push("]"),t.join("")}toString(t=10){if(2>t||36<t)throw new RangeError("toString() radix argument must be between 2 and 36");return 0===this.length?"0":0==(t&t-1)?l.__toStringBasePowerOfTwo(this,t):l.__toStringGeneric(this,t,!1)}static toNumber(t){var e=Math.clz32;const r=t.length;if(0===r)return 0;if(1===r){const e=t.__unsignedDigit(0);return t.sign?-e:e}const n=t.__digit(r-1),i=e(n),o=32*r-i;if(1024<o)return t.sign?-1/0:1/0;let s=o-1,a=n,u=r-1;const c=i+1;let _=32===c?0:a<<c;_>>>=12;const h=c-12;let f=12<=c?0:a<<20+c,g=20+c;0<h&&0<u&&(u--,a=t.__digit(u),_|=a>>>32-h,f=a<<h,g=h),0<g&&0<u&&(u--,a=t.__digit(u),f|=a>>>32-g,g-=32);const d=l.__decideRounding(t,g,u,a);if((1===d||0===d&&1==(1&f))&&(f=f+1>>>0,0==f&&(_++,0!=_>>>20&&(_=0,s++,1023<s))))return t.sign?-1/0:1/0;const p=t.sign?-2147483648:0;return s=s+1023<<20,l.__kBitConversionInts[1]=p|s|_,l.__kBitConversionInts[0]=f,l.__kBitConversionDouble[0]}static unaryMinus(t){if(0===t.length)return t;const e=t.__copy();return e.sign=!t.sign,e}static bitwiseNot(t){return t.sign?l.__absoluteSubOne(t).__trim():l.__absoluteAddOne(t,!0)}static exponentiate(t,e){if(e.sign)throw new RangeError("Exponent must be positive");if(0===e.length)return l.__oneDigit(1,!1);if(0===t.length)return t;if(1===t.length&&1===t.__digit(0))return t.sign&&0==(1&e.__digit(0))?l.unaryMinus(t):t;if(1<e.length)throw new RangeError("BigInt too big");let r=e.__unsignedDigit(0);if(1===r)return t;if(r>=l.__kMaxLengthBits)throw new RangeError("BigInt too big");if(1===t.length&&2===t.__digit(0)){const e=1+(r>>>5),n=t.sign&&0!=(1&r),i=new l(e,n);i.__initializeDigits();const o=1<<(31&r);return i.__setDigit(e-1,o),i}let n=null,i=t;for(0!=(1&r)&&(n=t),r>>=1;0!==r;r>>=1)i=l.multiply(i,i),0!=(1&r)&&(n=null===n?i:l.multiply(n,i));return n}static multiply(t,e){if(0===t.length)return t;if(0===e.length)return e;let r=t.length+e.length;32<=t.__clzmsd()+e.__clzmsd()&&r--;const n=new l(r,t.sign!==e.sign);n.__initializeDigits();for(let r=0;r<t.length;r++)l.__multiplyAccumulate(e,t.__digit(r),n,r);return n.__trim()}static divide(t,e){if(0===e.length)throw new RangeError("Division by zero");if(0>l.__absoluteCompare(t,e))return l.__zero();const r=t.sign!==e.sign,n=e.__unsignedDigit(0);let i;if(1===e.length&&65535>=n){if(1===n)return r===t.sign?t:l.unaryMinus(t);i=l.__absoluteDivSmall(t,n,null)}else i=l.__absoluteDivLarge(t,e,!0,!1);return i.sign=r,i.__trim()}static remainder(t,e){if(0===e.length)throw new RangeError("Division by zero");if(0>l.__absoluteCompare(t,e))return t;const r=e.__unsignedDigit(0);if(1===e.length&&65535>=r){if(1===r)return l.__zero();const e=l.__absoluteModSmall(t,r);return 0===e?l.__zero():l.__oneDigit(e,t.sign)}const n=l.__absoluteDivLarge(t,e,!1,!0);return n.sign=t.sign,n.__trim()}static add(t,e){const r=t.sign;return r===e.sign?l.__absoluteAdd(t,e,r):0<=l.__absoluteCompare(t,e)?l.__absoluteSub(t,e,r):l.__absoluteSub(e,t,!r)}static subtract(t,e){const r=t.sign;return r===e.sign?0<=l.__absoluteCompare(t,e)?l.__absoluteSub(t,e,r):l.__absoluteSub(e,t,!r):l.__absoluteAdd(t,e,r)}static leftShift(t,e){return 0===e.length||0===t.length?t:e.sign?l.__rightShiftByAbsolute(t,e):l.__leftShiftByAbsolute(t,e)}static signedRightShift(t,e){return 0===e.length||0===t.length?t:e.sign?l.__leftShiftByAbsolute(t,e):l.__rightShiftByAbsolute(t,e)}static unsignedRightShift(){throw new TypeError("BigInts have no unsigned right shift; use >> instead")}static lessThan(t,e){return 0>l.__compareToBigInt(t,e)}static lessThanOrEqual(t,e){return 0>=l.__compareToBigInt(t,e)}static greaterThan(t,e){return 0<l.__compareToBigInt(t,e)}static greaterThanOrEqual(t,e){return 0<=l.__compareToBigInt(t,e)}static equal(t,e){if(t.sign!==e.sign)return!1;if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t.__digit(r)!==e.__digit(r))return!1;return!0}static notEqual(t,e){return!l.equal(t,e)}static bitwiseAnd(t,e){var r=Math.max;if(!t.sign&&!e.sign)return l.__absoluteAnd(t,e).__trim();if(t.sign&&e.sign){const n=r(t.length,e.length)+1;let i=l.__absoluteSubOne(t,n);const o=l.__absoluteSubOne(e);return i=l.__absoluteOr(i,o,i),l.__absoluteAddOne(i,!0,i).__trim()}return t.sign&&([t,e]=[e,t]),l.__absoluteAndNot(t,l.__absoluteSubOne(e)).__trim()}static bitwiseXor(t,e){var r=Math.max;if(!t.sign&&!e.sign)return l.__absoluteXor(t,e).__trim();if(t.sign&&e.sign){const n=r(t.length,e.length),i=l.__absoluteSubOne(t,n),o=l.__absoluteSubOne(e);return l.__absoluteXor(i,o,i).__trim()}const n=r(t.length,e.length)+1;t.sign&&([t,e]=[e,t]);let i=l.__absoluteSubOne(e,n);return i=l.__absoluteXor(i,t,i),l.__absoluteAddOne(i,!0,i).__trim()}static bitwiseOr(t,e){const r=(0,Math.max)(t.length,e.length);if(!t.sign&&!e.sign)return l.__absoluteOr(t,e).__trim();if(t.sign&&e.sign){let n=l.__absoluteSubOne(t,r);const i=l.__absoluteSubOne(e);return n=l.__absoluteAnd(n,i,n),l.__absoluteAddOne(n,!0,n).__trim()}t.sign&&([t,e]=[e,t]);let n=l.__absoluteSubOne(e,r);return n=l.__absoluteAndNot(n,t,n),l.__absoluteAddOne(n,!0,n).__trim()}static asIntN(t,e){if(0===e.length)return e;if(0===t)return l.__zero();if(t>=l.__kMaxLengthBits)return e;const r=t+31>>>5;if(e.length<r)return e;const n=e.__unsignedDigit(r-1),i=1<<(31&t-1);if(e.length===r&&n<i)return e;if((n&i)!==i)return l.__truncateToNBits(t,e);if(!e.sign)return l.__truncateAndSubFromPowerOfTwo(t,e,!0);if(0==(n&i-1)){for(let n=r-2;0<=n;n--)if(0!==e.__digit(n))return l.__truncateAndSubFromPowerOfTwo(t,e,!1);return e.length===r&&n===i?e:l.__truncateToNBits(t,e)}return l.__truncateAndSubFromPowerOfTwo(t,e,!1)}static asUintN(t,e){if(0===e.length)return e;if(0===t)return l.__zero();if(e.sign){if(t>l.__kMaxLengthBits)throw new RangeError("BigInt too big");return l.__truncateAndSubFromPowerOfTwo(t,e,!1)}if(t>=l.__kMaxLengthBits)return e;const r=t+31>>>5;if(e.length<r)return e;const n=31&t;if(e.length==r){if(0==n)return e;if(0==e.__digit(r-1)>>>n)return e}return l.__truncateToNBits(t,e)}static ADD(t,e){if(t=l.__toPrimitive(t),e=l.__toPrimitive(e),"string"==typeof t)return"string"!=typeof e&&(e=e.toString()),t+e;if("string"==typeof e)return t.toString()+e;if(t=l.__toNumeric(t),e=l.__toNumeric(e),l.__isBigInt(t)&&l.__isBigInt(e))return l.add(t,e);if("number"==typeof t&&"number"==typeof e)return t+e;throw new TypeError("Cannot mix BigInt and other types, use explicit conversions")}static LT(t,e){return l.__compare(t,e,0)}static LE(t,e){return l.__compare(t,e,1)}static GT(t,e){return l.__compare(t,e,2)}static GE(t,e){return l.__compare(t,e,3)}static EQ(t,e){for(;;){if(l.__isBigInt(t))return l.__isBigInt(e)?l.equal(t,e):l.EQ(e,t);if("number"==typeof t){if(l.__isBigInt(e))return l.__equalToNumber(e,t);if("object"!=typeof e)return t==e;e=l.__toPrimitive(e)}else if("string"==typeof t){if(l.__isBigInt(e))return null!==(t=l.__fromString(t))&&l.equal(t,e);if("object"!=typeof e)return t==e;e=l.__toPrimitive(e)}else if("boolean"==typeof t){if(l.__isBigInt(e))return l.__equalToNumber(e,+t);if("object"!=typeof e)return t==e;e=l.__toPrimitive(e)}else if("symbol"==typeof t){if(l.__isBigInt(e))return!1;if("object"!=typeof e)return t==e;e=l.__toPrimitive(e)}else{if("object"!=typeof t)return t==e;if("object"==typeof e&&e.constructor!==l)return t==e;t=l.__toPrimitive(t)}}}static NE(t,e){return!l.EQ(t,e)}static __zero(){return new l(0,!1)}static __oneDigit(t,e){const r=new l(1,e);return r.__setDigit(0,t),r}__copy(){const t=new l(this.length,this.sign);for(let e=0;e<this.length;e++)t[e]=this[e];return t}__trim(){let t=this.length,e=this[t-1];for(;0===e;)t--,e=this[t-1],this.pop();return 0===t&&(this.sign=!1),this}__initializeDigits(){for(let t=0;t<this.length;t++)this[t]=0}static __decideRounding(t,e,r,n){if(0<e)return-1;let i;if(0>e)i=-e-1;else{if(0===r)return-1;r--,n=t.__digit(r),i=31}let o=1<<i;if(0==(n&o))return-1;if(o-=1,0!=(n&o))return 1;for(;0<r;)if(r--,0!==t.__digit(r))return 1;return 0}static __fromDouble(t){l.__kBitConversionDouble[0]=t;const e=(2047&l.__kBitConversionInts[1]>>>20)-1023,r=1+(e>>>5),n=new l(r,0>t);let i=1048575&l.__kBitConversionInts[1]|1048576,o=l.__kBitConversionInts[0];const s=31&e;let a,u=0;if(s<20){const t=20-s;u=t+32,a=i>>>t,i=i<<32-t|o>>>t,o<<=32-t}else if(20===s)u=32,a=i,i=o;else{const t=s-20;u=32-t,a=i<<t|o>>>32-t,i=o<<t}n.__setDigit(r-1,a);for(let t=r-2;0<=t;t--)0<u?(u-=32,a=i,i=o):a=0,n.__setDigit(t,a);return n.__trim()}static __isWhitespace(t){return!!(13>=t&&9<=t)||(159>=t?32==t:131071>=t?160==t||5760==t:196607>=t?10>=(t&=131071)||40==t||41==t||47==t||95==t||4096==t:65279==t)}static __fromString(t,e=0){let r=0;const n=t.length;let i=0;if(i===n)return l.__zero();let o=t.charCodeAt(i);for(;l.__isWhitespace(o);){if(++i===n)return l.__zero();o=t.charCodeAt(i)}if(43===o){if(++i===n)return null;o=t.charCodeAt(i),r=1}else if(45===o){if(++i===n)return null;o=t.charCodeAt(i),r=-1}if(0===e){if(e=10,48===o){if(++i===n)return l.__zero();if(o=t.charCodeAt(i),88===o||120===o){if(e=16,++i===n)return null;o=t.charCodeAt(i)}else if(79===o||111===o){if(e=8,++i===n)return null;o=t.charCodeAt(i)}else if(66===o||98===o){if(e=2,++i===n)return null;o=t.charCodeAt(i)}}}else if(16===e&&48===o){if(++i===n)return l.__zero();if(o=t.charCodeAt(i),88===o||120===o){if(++i===n)return null;o=t.charCodeAt(i)}}for(;48===o;){if(++i===n)return l.__zero();o=t.charCodeAt(i)}const s=n-i;let a=l.__kMaxBitsPerChar[e],u=l.__kBitsPerCharTableMultiplier-1;if(s>1073741824/a)return null;const c=a*s+u>>>l.__kBitsPerCharTableShift,_=new l(c+31>>>5,!1),h=10>e?e:10,f=10<e?e-10:0;if(0==(e&e-1)){a>>=l.__kBitsPerCharTableShift;const e=[],r=[];let s=!1;do{let u=0,l=0;for(;;){let e;if(o-48>>>0<h)e=o-48;else{if(!((32|o)-97>>>0<f)){s=!0;break}e=(32|o)-87}if(l+=a,u=u<<a|e,++i===n){s=!0;break}if(o=t.charCodeAt(i),32<l+a)break}e.push(u),r.push(l)}while(!s);l.__fillFromParts(_,e,r)}else{_.__initializeDigits();let r=!1,s=0;do{let c=0,g=1;for(;;){let a;if(o-48>>>0<h)a=o-48;else{if(!((32|o)-97>>>0<f)){r=!0;break}a=(32|o)-87}const u=g*e;if(4294967295<u)break;if(g=u,c=c*e+a,s++,++i===n){r=!0;break}o=t.charCodeAt(i)}u=32*l.__kBitsPerCharTableMultiplier-1;const d=a*s+u>>>l.__kBitsPerCharTableShift+5;_.__inplaceMultiplyAdd(g,c,d)}while(!r)}if(i!==n){if(!l.__isWhitespace(o))return null;for(i++;i<n;i++)if(o=t.charCodeAt(i),!l.__isWhitespace(o))return null}return 0!=r&&10!==e?null:(_.sign=-1==r,_.__trim())}static __fillFromParts(t,e,r){let n=0,i=0,o=0;for(let s=e.length-1;0<=s;s--){const a=e[s],u=r[s];i|=a<<o,o+=u,32===o?(t.__setDigit(n++,i),o=0,i=0):32<o&&(t.__setDigit(n++,i),o-=32,i=a>>>u-o)}if(0!==i){if(n>=t.length)throw new Error("implementation bug");t.__setDigit(n++,i)}for(;n<t.length;n++)t.__setDigit(n,0)}static __toStringBasePowerOfTwo(t,e){var r=Math.clz32;const n=t.length;let i=e-1;i=(85&i>>>1)+(85&i),i=(51&i>>>2)+(51&i),i=(15&i>>>4)+(15&i);const o=i,s=e-1,a=t.__digit(n-1);let u=0|(32*n-r(a)+o-1)/o;if(t.sign&&u++,268435456<u)throw new Error("string too long");const c=Array(u);let _=u-1,h=0,f=0;for(let e=0;e<n-1;e++){const r=t.__digit(e),n=(h|r<<f)&s;c[_--]=l.__kConversionChars[n];const i=o-f;for(h=r>>>i,f=32-i;f>=o;)c[_--]=l.__kConversionChars[h&s],h>>>=o,f-=o}const g=(h|a<<f)&s;for(c[_--]=l.__kConversionChars[g],h=a>>>o-f;0!==h;)c[_--]=l.__kConversionChars[h&s],h>>>=o;if(t.sign&&(c[_--]="-"),-1!=_)throw new Error("implementation bug");return c.join("")}static __toStringGeneric(t,e,r){var n=Math.clz32;const i=t.length;if(0===i)return"";if(1===i){let n=t.__unsignedDigit(0).toString(e);return!1===r&&t.sign&&(n="-"+n),n}const o=32*i-n(t.__digit(i-1)),s=l.__kMaxBitsPerChar[e]-1;let a=o*l.__kBitsPerCharTableMultiplier;a+=s-1,a=0|a/s;const u=a+1>>1,c=l.exponentiate(l.__oneDigit(e,!1),l.__oneDigit(u,!1));let _,h;const f=c.__unsignedDigit(0);if(1===c.length&&65535>=f){_=new l(t.length,!1),_.__initializeDigits();let r=0;for(let e=2*t.length-1;0<=e;e--){const n=r<<16|t.__halfDigit(e);_.__setHalfDigit(e,0|n/f),r=0|n%f}h=r.toString(e)}else{const r=l.__absoluteDivLarge(t,c,!0,!0);_=r.quotient;const n=r.remainder.__trim();h=l.__toStringGeneric(n,e,!0)}_.__trim();let g=l.__toStringGeneric(_,e,!0);for(;h.length<u;)h="0"+h;return!1===r&&t.sign&&(g="-"+g),g+h}static __unequalSign(t){return t?-1:1}static __absoluteGreater(t){return t?-1:1}static __absoluteLess(t){return t?1:-1}static __compareToBigInt(t,e){const r=t.sign;if(r!==e.sign)return l.__unequalSign(r);const n=l.__absoluteCompare(t,e);return 0<n?l.__absoluteGreater(r):0>n?l.__absoluteLess(r):0}static __compareToNumber(t,e){if(!0|e){const r=t.sign,n=0>e;if(r!==n)return l.__unequalSign(r);if(0===t.length){if(n)throw new Error("implementation bug");return 0===e?0:-1}if(1<t.length)return l.__absoluteGreater(r);const i=Math.abs(e),o=t.__unsignedDigit(0);return o>i?l.__absoluteGreater(r):o<i?l.__absoluteLess(r):0}return l.__compareToDouble(t,e)}static __compareToDouble(t,e){var r=Math.clz32;if(e!=e)return e;if(e===1/0)return-1;if(e===-1/0)return 1;const n=t.sign;if(n!==0>e)return l.__unequalSign(n);if(0===e)throw new Error("implementation bug: should be handled elsewhere");if(0===t.length)return-1;l.__kBitConversionDouble[0]=e;const i=2047&l.__kBitConversionInts[1]>>>20;if(2047==i)throw new Error("implementation bug: handled elsewhere");const o=i-1023;if(0>o)return l.__absoluteGreater(n);const s=t.length;let a=t.__digit(s-1);const u=r(a),c=32*s-u,_=o+1;if(c<_)return l.__absoluteLess(n);if(c>_)return l.__absoluteGreater(n);let h=1048576|1048575&l.__kBitConversionInts[1],f=l.__kBitConversionInts[0];const g=31-u;if(g!==(c-1)%31)throw new Error("implementation bug");let d,p=0;if(20>g){const t=20-g;p=t+32,d=h>>>t,h=h<<32-t|f>>>t,f<<=32-t}else if(20===g)p=32,d=h,h=f;else{const t=g-20;p=32-t,d=h<<t|f>>>32-t,h=f<<t}if(a>>>=0,d>>>=0,a>d)return l.__absoluteGreater(n);if(a<d)return l.__absoluteLess(n);for(let e=s-2;0<=e;e--){0<p?(p-=32,d=h>>>0,h=f,f=0):d=0;const r=t.__unsignedDigit(e);if(r>d)return l.__absoluteGreater(n);if(r<d)return l.__absoluteLess(n)}if(0!==h||0!==f){if(0===p)throw new Error("implementation bug");return l.__absoluteLess(n)}return 0}static __equalToNumber(t,e){var r=Math.abs;return e|0===e?0===e?0===t.length:1===t.length&&t.sign===0>e&&t.__unsignedDigit(0)===r(e):0===l.__compareToDouble(t,e)}static __comparisonResultToBool(t,e){switch(e){case 0:return 0>t;case 1:return 0>=t;case 2:return 0<t;case 3:return 0<=t}throw new Error("unreachable")}static __compare(t,e,r){if(t=l.__toPrimitive(t),e=l.__toPrimitive(e),"string"==typeof t&&"string"==typeof e)switch(r){case 0:return t<e;case 1:return t<=e;case 2:return t>e;case 3:return t>=e}if(l.__isBigInt(t)&&"string"==typeof e)return null!==(e=l.__fromString(e))&&l.__comparisonResultToBool(l.__compareToBigInt(t,e),r);if("string"==typeof t&&l.__isBigInt(e))return null!==(t=l.__fromString(t))&&l.__comparisonResultToBool(l.__compareToBigInt(t,e),r);if(t=l.__toNumeric(t),e=l.__toNumeric(e),l.__isBigInt(t)){if(l.__isBigInt(e))return l.__comparisonResultToBool(l.__compareToBigInt(t,e),r);if("number"!=typeof e)throw new Error("implementation bug");return l.__comparisonResultToBool(l.__compareToNumber(t,e),r)}if("number"!=typeof t)throw new Error("implementation bug");if(l.__isBigInt(e))return l.__comparisonResultToBool(l.__compareToNumber(e,t),2^r);if("number"!=typeof e)throw new Error("implementation bug");return 0===r?t<e:1===r?t<=e:2===r?t>e:3===r?t>=e:void 0}__clzmsd(){return Math.clz32(this[this.length-1])}static __absoluteAdd(t,e,r){if(t.length<e.length)return l.__absoluteAdd(e,t,r);if(0===t.length)return t;if(0===e.length)return t.sign===r?t:l.unaryMinus(t);let n=t.length;(0===t.__clzmsd()||e.length===t.length&&0===e.__clzmsd())&&n++;const i=new l(n,r);let o=0,s=0;for(;s<e.length;s++){const r=e.__digit(s),n=t.__digit(s),a=(65535&n)+(65535&r)+o,u=(n>>>16)+(r>>>16)+(a>>>16);o=u>>>16,i.__setDigit(s,65535&a|u<<16)}for(;s<t.length;s++){const e=t.__digit(s),r=(65535&e)+o,n=(e>>>16)+(r>>>16);o=n>>>16,i.__setDigit(s,65535&r|n<<16)}return s<i.length&&i.__setDigit(s,o),i.__trim()}static __absoluteSub(t,e,r){if(0===t.length)return t;if(0===e.length)return t.sign===r?t:l.unaryMinus(t);const n=new l(t.length,r);let i=0,o=0;for(;o<e.length;o++){const r=t.__digit(o),s=e.__digit(o),a=(65535&r)-(65535&s)-i;i=1&a>>>16;const u=(r>>>16)-(s>>>16)-i;i=1&u>>>16,n.__setDigit(o,65535&a|u<<16)}for(;o<t.length;o++){const e=t.__digit(o),r=(65535&e)-i;i=1&r>>>16;const s=(e>>>16)-i;i=1&s>>>16,n.__setDigit(o,65535&r|s<<16)}return n.__trim()}static __absoluteAddOne(t,e,r=null){const n=t.length;null===r?r=new l(n,e):r.sign=e;let i=!0;for(let e,o=0;o<n;o++){e=t.__digit(o);const n=-1===e;i&&(e=0|e+1),i=n,r.__setDigit(o,e)}return i&&r.__setDigitGrow(n,1),r}static __absoluteSubOne(t,e){const r=t.length,n=new l(e=e||r,!1);let i=!0;for(let e,o=0;o<r;o++){e=t.__digit(o);const r=0===e;i&&(e=0|e-1),i=r,n.__setDigit(o,e)}for(let t=r;t<e;t++)n.__setDigit(t,0);return n}static __absoluteAnd(t,e,r=null){let n=t.length,i=e.length,o=i;if(n<i){o=n;const r=t,s=n;t=e,n=i,e=r,i=s}let s=o;null===r?r=new l(s,!1):s=r.length;let a=0;for(;a<o;a++)r.__setDigit(a,t.__digit(a)&e.__digit(a));for(;a<s;a++)r.__setDigit(a,0);return r}static __absoluteAndNot(t,e,r=null){const n=t.length,i=e.length;let o=i;n<i&&(o=n);let s=n;null===r?r=new l(s,!1):s=r.length;let a=0;for(;a<o;a++)r.__setDigit(a,t.__digit(a)&~e.__digit(a));for(;a<n;a++)r.__setDigit(a,t.__digit(a));for(;a<s;a++)r.__setDigit(a,0);return r}static __absoluteOr(t,e,r=null){let n=t.length,i=e.length,o=i;if(n<i){o=n;const r=t,s=n;t=e,n=i,e=r,i=s}let s=n;null===r?r=new l(s,!1):s=r.length;let a=0;for(;a<o;a++)r.__setDigit(a,t.__digit(a)|e.__digit(a));for(;a<n;a++)r.__setDigit(a,t.__digit(a));for(;a<s;a++)r.__setDigit(a,0);return r}static __absoluteXor(t,e,r=null){let n=t.length,i=e.length,o=i;if(n<i){o=n;const r=t,s=n;t=e,n=i,e=r,i=s}let s=n;null===r?r=new l(s,!1):s=r.length;let a=0;for(;a<o;a++)r.__setDigit(a,t.__digit(a)^e.__digit(a));for(;a<n;a++)r.__setDigit(a,t.__digit(a));for(;a<s;a++)r.__setDigit(a,0);return r}static __absoluteCompare(t,e){const r=t.length-e.length;if(0!=r)return r;let n=t.length-1;for(;0<=n&&t.__digit(n)===e.__digit(n);)n--;return 0>n?0:t.__unsignedDigit(n)>e.__unsignedDigit(n)?1:-1}static __multiplyAccumulate(t,e,r,n){var i=Math.imul;if(0===e)return;const o=65535&e,s=e>>>16;let a=0,u=0,l=0;for(let e=0;e<t.length;e++,n++){let c=r.__digit(n),_=65535&c,h=c>>>16;const f=t.__digit(e),g=65535&f,d=f>>>16,p=i(g,o),b=i(g,s),m=i(d,o),y=i(d,s);_+=u+(65535&p),h+=l+a+(_>>>16)+(p>>>16)+(65535&b)+(65535&m),a=h>>>16,u=(b>>>16)+(m>>>16)+(65535&y)+a,a=u>>>16,u&=65535,l=y>>>16,c=65535&_|h<<16,r.__setDigit(n,c)}for(;0!=a||0!==u||0!==l;n++){let t=r.__digit(n);const e=(65535&t)+u,i=(t>>>16)+(e>>>16)+l+a;u=0,l=0,a=i>>>16,t=65535&e|i<<16,r.__setDigit(n,t)}}static __internalMultiplyAdd(t,e,r,n,i){var o=Math.imul;let s=r,a=0;for(let r=0;r<n;r++){const n=t.__digit(r),u=o(65535&n,e),l=(65535&u)+a+s;s=l>>>16;const c=o(n>>>16,e),_=(65535&c)+(u>>>16)+s;s=_>>>16,a=c>>>16,i.__setDigit(r,_<<16|65535&l)}if(i.length>n)for(i.__setDigit(n++,s+a);n<i.length;)i.__setDigit(n++,0);else if(0!==s+a)throw new Error("implementation bug")}__inplaceMultiplyAdd(t,e,r){var n=Math.imul;r>this.length&&(r=this.length);const i=65535&t,o=t>>>16;let s=0,a=65535&e,u=e>>>16;for(let t=0;t<r;t++){const e=this.__digit(t),r=65535&e,l=e>>>16,c=n(r,i),_=n(r,o),h=n(l,i),f=n(l,o),g=a+(65535&c),d=u+s+(g>>>16)+(c>>>16)+(65535&_)+(65535&h);a=(_>>>16)+(h>>>16)+(65535&f)+(d>>>16),s=a>>>16,a&=65535,u=f>>>16,this.__setDigit(t,65535&g|d<<16)}if(0!=s||0!==a||0!==u)throw new Error("implementation bug")}static __absoluteDivSmall(t,e,r){null===r&&(r=new l(t.length,!1));let n=0;for(let i,o=2*t.length-1;0<=o;o-=2){i=(n<<16|t.__halfDigit(o))>>>0;const s=0|i/e;n=0|i%e,i=(n<<16|t.__halfDigit(o-1))>>>0;const a=0|i/e;n=0|i%e,r.__setDigit(o>>>1,s<<16|a)}return r}static __absoluteModSmall(t,e){let r=0;for(let n=2*t.length-1;0<=n;n--){r=0|((r<<16|t.__halfDigit(n))>>>0)%e}return r}static __absoluteDivLarge(t,e,r,n){var i=Math.imul;const o=e.__halfDigitLength(),s=e.length,a=t.__halfDigitLength()-o;let u=null;r&&(u=new l(a+2>>>1,!1),u.__initializeDigits());const c=new l(o+2>>>1,!1);c.__initializeDigits();const _=l.__clz16(e.__halfDigit(o-1));0<_&&(e=l.__specialLeftShift(e,_,0));const h=l.__specialLeftShift(t,_,1),f=e.__halfDigit(o-1);let g=0;for(let t,n=a;0<=n;n--){t=65535;const a=h.__halfDigit(n+o);if(a!==f){const r=(a<<16|h.__halfDigit(n+o-1))>>>0;t=0|r/f;let s=0|r%f;const u=e.__halfDigit(o-2),l=h.__halfDigit(n+o-2);for(;i(t,u)>>>0>(s<<16|l)>>>0&&(t--,s+=f,!(65535<s)););}l.__internalMultiplyAdd(e,t,0,s,c);let _=h.__inplaceSub(c,n,o+1);0!==_&&(_=h.__inplaceAdd(e,n,o),h.__setHalfDigit(n+o,h.__halfDigit(n+o)+_),t--),r&&(1&n?g=t<<16:u.__setDigit(n>>>1,g|t))}return n?(h.__inplaceRightShift(_),r?{quotient:u,remainder:h}:h):r?u:void 0}static __clz16(t){return Math.clz32(t)-16}__inplaceAdd(t,e,r){let n=0;for(let i=0;i<r;i++){const r=this.__halfDigit(e+i)+t.__halfDigit(i)+n;n=r>>>16,this.__setHalfDigit(e+i,r)}return n}__inplaceSub(t,e,r){let n=0;if(1&e){e>>=1;let i=this.__digit(e),o=65535&i,s=0;for(;s<r-1>>>1;s++){const r=t.__digit(s),a=(i>>>16)-(65535&r)-n;n=1&a>>>16,this.__setDigit(e+s,a<<16|65535&o),i=this.__digit(e+s+1),o=(65535&i)-(r>>>16)-n,n=1&o>>>16}const a=t.__digit(s),u=(i>>>16)-(65535&a)-n;if(n=1&u>>>16,this.__setDigit(e+s,u<<16|65535&o),e+s+1>=this.length)throw new RangeError("out of bounds");0==(1&r)&&(i=this.__digit(e+s+1),o=(65535&i)-(a>>>16)-n,n=1&o>>>16,this.__setDigit(e+t.length,4294901760&i|65535&o))}else{e>>=1;let i=0;for(;i<t.length-1;i++){const r=this.__digit(e+i),o=t.__digit(i),s=(65535&r)-(65535&o)-n;n=1&s>>>16;const a=(r>>>16)-(o>>>16)-n;n=1&a>>>16,this.__setDigit(e+i,a<<16|65535&s)}const o=this.__digit(e+i),s=t.__digit(i),a=(65535&o)-(65535&s)-n;n=1&a>>>16;let u=0;0==(1&r)&&(u=(o>>>16)-(s>>>16)-n,n=1&u>>>16),this.__setDigit(e+i,u<<16|65535&a)}return n}__inplaceRightShift(t){if(0===t)return;let e=this.__digit(0)>>>t;const r=this.length-1;for(let n=0;n<r;n++){const r=this.__digit(n+1);this.__setDigit(n,r<<32-t|e),e=r>>>t}this.__setDigit(r,e)}static __specialLeftShift(t,e,r){const n=t.length,i=new l(n+r,!1);if(0===e){for(let e=0;e<n;e++)i.__setDigit(e,t.__digit(e));return 0<r&&i.__setDigit(n,0),i}let o=0;for(let r=0;r<n;r++){const n=t.__digit(r);i.__setDigit(r,n<<e|o),o=n>>>32-e}return 0<r&&i.__setDigit(n,o),i}static __leftShiftByAbsolute(t,e){const r=l.__toShiftAmount(e);if(0>r)throw new RangeError("BigInt too big");const n=r>>>5,i=31&r,o=t.length,s=0!==i&&0!=t.__digit(o-1)>>>32-i,a=o+n+(s?1:0),u=new l(a,t.sign);if(0===i){let e=0;for(;e<n;e++)u.__setDigit(e,0);for(;e<a;e++)u.__setDigit(e,t.__digit(e-n))}else{let e=0;for(let t=0;t<n;t++)u.__setDigit(t,0);for(let r=0;r<o;r++){const o=t.__digit(r);u.__setDigit(r+n,o<<i|e),e=o>>>32-i}if(s)u.__setDigit(o+n,e);else if(0!=e)throw new Error("implementation bug")}return u.__trim()}static __rightShiftByAbsolute(t,e){const r=t.length,n=t.sign,i=l.__toShiftAmount(e);if(0>i)return l.__rightShiftByMaximum(n);const o=i>>>5,s=31&i;let a=r-o;if(0>=a)return l.__rightShiftByMaximum(n);let u=!1;if(n)if(0!=(t.__digit(o)&(1<<s)-1))u=!0;else for(let e=0;e<o;e++)if(0!==t.__digit(e)){u=!0;break}if(u&&0===s){0==~t.__digit(r-1)&&a++}let c=new l(a,n);if(0===s)for(let e=o;e<r;e++)c.__setDigit(e-o,t.__digit(e));else{let e=t.__digit(o)>>>s;const n=r-o-1;for(let r=0;r<n;r++){const n=t.__digit(r+o+1);c.__setDigit(r,n<<32-s|e),e=n>>>s}c.__setDigit(n,e)}return u&&(c=l.__absoluteAddOne(c,!0,c)),c.__trim()}static __rightShiftByMaximum(t){return t?l.__oneDigit(1,!0):l.__zero()}static __toShiftAmount(t){if(1<t.length)return-1;const e=t.__unsignedDigit(0);return e>l.__kMaxLengthBits?-1:e}static __toPrimitive(t,e="default"){if("object"!=typeof t)return t;if(t.constructor===l)return t;const r=t[Symbol.toPrimitive];if(r){const t=r(e);if("object"!=typeof t)return t;throw new TypeError("Cannot convert object to primitive value")}const n=t.valueOf;if(n){const e=n.call(t);if("object"!=typeof e)return e}const i=t.toString;if(i){const e=i.call(t);if("object"!=typeof e)return e}throw new TypeError("Cannot convert object to primitive value")}static __toNumeric(t){return l.__isBigInt(t)?t:+t}static __isBigInt(t){return"object"==typeof t&&t.constructor===l}static __truncateToNBits(t,e){const r=t+31>>>5,n=new l(r,e.sign),i=r-1;for(let t=0;t<i;t++)n.__setDigit(t,e.__digit(t));let o=e.__digit(i);if(0!=(31&t)){const e=32-(31&t);o=o<<e>>>e}return n.__setDigit(i,o),n.__trim()}static __truncateAndSubFromPowerOfTwo(t,e,r){var n=Math.min;const i=t+31>>>5,o=new l(i,r);let s=0;const a=i-1;let u=0;for(const t=n(a,e.length);s<t;s++){const t=e.__digit(s),r=0-(65535&t)-u;u=1&r>>>16;const n=0-(t>>>16)-u;u=1&n>>>16,o.__setDigit(s,65535&r|n<<16)}for(;s<a;s++)o.__setDigit(s,0|-u);let c=a<e.length?e.__digit(a):0;const _=31&t;let h;if(0==_){const t=0-(65535&c)-u;u=1&t>>>16,h=65535&t|0-(c>>>16)-u<<16}else{const t=32-_;c=c<<t>>>t;const e=1<<32-t,r=(65535&e)-(65535&c)-u;u=1&r>>>16,h=65535&r|(e>>>16)-(c>>>16)-u<<16,h&=e-1}return o.__setDigit(a,h),o.__trim()}__digit(t){return this[t]}__unsignedDigit(t){return this[t]>>>0}__setDigit(t,e){this[t]=0|e}__setDigitGrow(t,e){this[t]=0|e}__halfDigitLength(){const t=this.length;return 65535>=this.__unsignedDigit(t-1)?2*t-1:2*t}__halfDigit(t){return 65535&this[t>>>1]>>>((1&t)<<4)}__setHalfDigit(t,e){const r=t>>>1,n=this.__digit(r),i=1&t?65535&n|e<<16:4294901760&n|65535&e;this.__setDigit(r,i)}static __digitPow(t,e){let r=1;for(;0<e;)1&e&&(r*=t),e>>>=1,t*=t;return r}}function c(t,e,r,n=[]){!function(t,e){if(!(e instanceof Object))throw new Error(`${t} is not an object!`)}(t,e);const i=Object.keys(e).sort(),o=r.length,s=r.length+n.length,a=`${t} does not have correct keys! Required keys: [${r.sort().join(", ")}], optional keys: [${n.sort().join(", ")}], actual keys: [${i.join(", ")}]`;if(i.length<o||i.length>s)throw new Error(a);let u=i.filter(t=>!r.includes(t));if(i.length-u.length!==o)throw new Error(a);if(u.find(t=>!n.includes(t)))throw new Error(a)}function _(t,e){if(!/^0x([0-9a-fA-F][0-9a-fA-F])*$/.test(e))throw new Error(`${t} must be a hex string!`)}function h(t,e){if(_(t,e),66!=e.length)throw new Error(`${t} must be a hex string of 66 bytes long!`)}function f(t,e){if("0x0"!==e&&!/^0x[1-9a-fA-F][0-9a-fA-F]*$/.test(e))throw new Error(`${t} must be a hex integer!`)}function g(t,{nestedValidation:e=!0,debugPath:r="script"}={}){if(c(r,t,["code_hash","hash_type","args"],[]),h(`${r}.code_hash`,t.code_hash),_(`${r}.args`,t.args),"data"!==t.hash_type&&"type"!==t.hash_type)throw new Error(`${r}.hash_type must be either data or type!`)}function d(t,{nestedValidation:e=!0,debugPath:r="out_point"}={}){c(r,t,["tx_hash","index"],[]),h(`${r}.tx_hash`,t.tx_hash),f(`${r}.index`,t.index)}function p(t,{nestedValidation:e=!0,debugPath:r="cell_input"}={}){c(r,t,["since","previous_output"],[]),f(`${r}.since`,t.since),e&&d(t.previous_output,{debugPath:`${r}.previous_output`})}function b(t,{nestedValidation:e=!0,debugPath:r="cell_output"}={}){c(r,t,["capacity","lock"],["type"]),f(`${r}.capacity`,t.capacity),e&&(g(t.lock,{debugPath:`${r}.lock`}),t.type&&g(t.type,{debugPath:`${r}.type`}))}function m(t,{nestedValidation:e=!0,debugPath:r="cell_dep"}={}){if(c(r,t,["out_point","dep_type"],[]),"code"!==t.dep_type&&"dep_group"!==t.dep_type)throw new Error(`${r}.dep_type must be either code or dep_group!`);e&&d(t.out_point,{debugPath:`${r}.out_point`})}function y(t,e,r,n){if(!Array.isArray(e))throw new Error(`${t} is not an array!`);if(n)for(let n=0;n<e.length;n++)r(`${t}[${n}]`,e[n])}function w(t,e){return function(r,n){t(n,{nestedValidation:e,debugPath:r})}}function v(t,e,r){f(`${t}.version`,e.version),y(`${t}.cell_deps`,e.cell_deps,w(m,r),r),y(`${t}.header_deps`,e.header_deps,h,r),y(`${t}.inputs`,e.inputs,w(p,r),r),y(`${t}.outputs`,e.outputs,w(b,r),r),y(`${t}.outputs_data`,e.outputs_data,_,r)}function B(t,{nestedValidation:e=!0,debugPath:r="raw_transaction"}={}){c(r,t,["version","cell_deps","header_deps","inputs","outputs","outputs_data"],[]),v(r,t,e)}function P(t,{nestedValidation:e=!0,debugPath:r="transaction"}={}){c(r,t,["version","cell_deps","header_deps","inputs","outputs","outputs_data","witnesses"],[]),v(r,t,e),y(`${r}.witnesses`,t.witnesses,_,e)}function D(t,{nestedValidation:e=!0,debugPath:r="raw_header"}={}){c(r,t,["version","compact_target","timestamp","number","epoch","parent_hash","transactions_root","proposals_hash","uncles_hash","dao"],[]),function(t,e){f(`${t}.version`,e.version),f(`${t}.compact_target`,e.compact_target),f(`${t}.timestamp`,e.timestamp),f(`${t}.number`,e.number),f(`${t}.epoch`,e.epoch),h(`${t}.parent_hash`,e.parent_hash),h(`${t}.transactions_root`,e.transactions_root),h(`${t}.proposals_hash`,e.proposals_hash),h(`${t}.uncles_hash`,e.uncles_hash),h(`${t}.dao`,e.dao)}(r,t)}function S(t,{nestedValidation:e=!0,debugPath:r="header"}={}){if(c(r,t,["version","compact_target","timestamp","number","epoch","parent_hash","transactions_root","proposals_hash","uncles_hash","dao","nonce"],[]),_(`${r}.nonce`,t.nonce),34!=t.nonce.length)throw new Error(`${r}.nonce must be a hex string of 34 bytes long!`)}function T(t,e){if(_(t,e),22!=e.length)throw new Error(`${t} must be a hex string of 22 bytes long!`)}function $(t,{nestedValidation:e=!0,debugPath:r="uncle_block"}={}){c(r,t,["header","proposals"],[]),e&&S(t.header,{debugPath:`${r}.header`}),y(`${r}.proposals`,t.proposals,T,e)}function k(t,{nestedValidation:e=!0,debugPath:r="block"}={}){c(r,t,["header","uncles","transactions","proposals"],[]),e&&S(t.header,{debugPath:`${r}.header`}),y(`${r}.uncles`,t.uncles,w($,e),e),y(`${r}.transactions`,t.transactions,w(P,e),e),y(`${r}.proposals`,t.proposals,T,e)}function x(t,{nestedValidation:e=!0,debugPath:r="cellbase_witness"}={}){c(r,t,["lock","message"],[]),_(`${r}.message`,t.message),e&&g(t.lock,{debugPath:`${r}.lock`})}function C(t,{nestedValidation:e=!0,debugPath:r="witness_args"}={}){c(r,t,[],["lock","input_type","output_type"]),t.lock&&_(`${r}.lock`,t.lock),t.input_type&&_(`${r}.input_type`,t.input_type),t.output_type&&_(`${r}.output_type`,t.output_type)}l.__kMaxLength=33554432,l.__kMaxLengthBits=l.__kMaxLength<<5,l.__kMaxBitsPerChar=[0,0,32,51,64,75,83,90,96,102,107,111,115,119,122,126,128,131,134,136,139,141,143,145,147,149,151,153,154,156,158,159,160,162,163,165,166],l.__kBitsPerCharTableShift=5,l.__kBitsPerCharTableMultiplier=1<<l.__kBitsPerCharTableShift,l.__kConversionChars=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],l.__kBitConversionBuffer=new ArrayBuffer(8),l.__kBitConversionDouble=new Float64Array(l.__kBitConversionBuffer),l.__kBitConversionInts=new Int32Array(l.__kBitConversionBuffer);var E=Object.freeze({__proto__:null,ValidateScript:g,ValidateOutPoint:d,ValidateCellInput:p,ValidateCellOutput:b,ValidateCellDep:m,ValidateRawTransaction:B,ValidateTransaction:P,ValidateRawHeader:D,ValidateHeader:S,ValidateUncleBlock:$,ValidateBlock:k,ValidateCellbaseWitness:x,ValidateWitnessArgs:C});const A=e.Readable,O=Symbol("buffer"),j=Symbol("type");class z{constructor(){this[j]="";const t=arguments[0],e=arguments[1],r=[];let n=0;if(t){const e=t,i=Number(e.length);for(let t=0;t<i;t++){const i=e[t];let o;o=i instanceof Buffer?i:ArrayBuffer.isView(i)?Buffer.from(i.buffer,i.byteOffset,i.byteLength):i instanceof ArrayBuffer?Buffer.from(i):i instanceof z?i[O]:Buffer.from("string"==typeof i?i:String(i)),n+=o.length,r.push(o)}}this[O]=Buffer.concat(r);let i=e&&void 0!==e.type&&String(e.type).toLowerCase();i&&!/[^\u0020-\u007E]/.test(i)&&(this[j]=i)}get size(){return this[O].length}get type(){return this[j]}text(){return Promise.resolve(this[O].toString())}arrayBuffer(){const t=this[O],e=t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);return Promise.resolve(e)}stream(){const t=new A;return t._read=function(){},t.push(this[O]),t.push(null),t}toString(){return"[object Blob]"}slice(){const t=this.size,e=arguments[0],r=arguments[1];let n,i;n=void 0===e?0:e<0?Math.max(t+e,0):Math.min(e,t),i=void 0===r?t:r<0?Math.max(t+r,0):Math.min(r,t);const o=Math.max(i-n,0),s=this[O].slice(n,n+o),a=new z([],{type:arguments[2]});return a[O]=s,a}}function I(t,e,r){Error.call(this,t),this.message=t,this.type=e,r&&(this.code=this.errno=r.code),Error.captureStackTrace(this,this.constructor)}let R;Object.defineProperties(z.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(z.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),I.prototype=Object.create(Error.prototype),I.prototype.constructor=I,I.prototype.name="FetchError";try{R=require("encoding").convert}catch(t){}const L=Symbol("Body internals"),M=e.PassThrough;function N(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.size;let o=void 0===i?0:i;var s=n.timeout;let a=void 0===s?0:s;null==t?t=null:U(t)?t=Buffer.from(t.toString()):V(t)||Buffer.isBuffer(t)||("[object ArrayBuffer]"===Object.prototype.toString.call(t)?t=Buffer.from(t):ArrayBuffer.isView(t)?t=Buffer.from(t.buffer,t.byteOffset,t.byteLength):t instanceof e||(t=Buffer.from(String(t)))),this[L]={body:t,disturbed:!1,error:null},this.size=o,this.timeout=a,t instanceof e&&t.on("error",(function(t){const e="AbortError"===t.name?t:new I(`Invalid response body while trying to fetch ${r.url}: ${t.message}`,"system",t);r[L].error=e}))}function q(){var t=this;if(this[L].disturbed)return N.Promise.reject(new TypeError(`body used already for: ${this.url}`));if(this[L].disturbed=!0,this[L].error)return N.Promise.reject(this[L].error);let r=this.body;if(null===r)return N.Promise.resolve(Buffer.alloc(0));if(V(r)&&(r=r.stream()),Buffer.isBuffer(r))return N.Promise.resolve(r);if(!(r instanceof e))return N.Promise.resolve(Buffer.alloc(0));let n=[],i=0,o=!1;return new N.Promise((function(e,s){let a;t.timeout&&(a=setTimeout((function(){o=!0,s(new I(`Response timeout while trying to fetch ${t.url} (over ${t.timeout}ms)`,"body-timeout"))}),t.timeout)),r.on("error",(function(e){"AbortError"===e.name?(o=!0,s(e)):s(new I(`Invalid response body while trying to fetch ${t.url}: ${e.message}`,"system",e))})),r.on("data",(function(e){if(!o&&null!==e){if(t.size&&i+e.length>t.size)return o=!0,void s(new I(`content size at ${t.url} over limit: ${t.size}`,"max-size"));i+=e.length,n.push(e)}})),r.on("end",(function(){if(!o){clearTimeout(a);try{e(Buffer.concat(n,i))}catch(e){s(new I(`Could not create Buffer from response body for ${t.url}: ${e.message}`,"system",e))}}}))}))}function U(t){return"object"==typeof t&&"function"==typeof t.append&&"function"==typeof t.delete&&"function"==typeof t.get&&"function"==typeof t.getAll&&"function"==typeof t.has&&"function"==typeof t.set&&("URLSearchParams"===t.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(t)||"function"==typeof t.sort)}function V(t){return"object"==typeof t&&"function"==typeof t.arrayBuffer&&"string"==typeof t.type&&"function"==typeof t.stream&&"function"==typeof t.constructor&&"string"==typeof t.constructor.name&&/^(Blob|File)$/.test(t.constructor.name)&&/^(Blob|File)$/.test(t[Symbol.toStringTag])}function H(t){let r,n,i=t.body;if(t.bodyUsed)throw new Error("cannot clone body after it is used");return i instanceof e&&"function"!=typeof i.getBoundary&&(r=new M,n=new M,i.pipe(r),i.pipe(n),t[L].body=r,i=n),i}function F(t){return null===t?null:"string"==typeof t?"text/plain;charset=UTF-8":U(t)?"application/x-www-form-urlencoded;charset=UTF-8":V(t)?t.type||null:Buffer.isBuffer(t)||"[object ArrayBuffer]"===Object.prototype.toString.call(t)||ArrayBuffer.isView(t)?null:"function"==typeof t.getBoundary?`multipart/form-data;boundary=${t.getBoundary()}`:t instanceof e?null:"text/plain;charset=UTF-8"}function G(t){const e=t.body;return null===e?0:V(e)?e.size:Buffer.isBuffer(e)?e.length:e&&"function"==typeof e.getLengthSync&&(e._lengthRetrievers&&0==e._lengthRetrievers.length||e.hasKnownLength&&e.hasKnownLength())?e.getLengthSync():null}N.prototype={get body(){return this[L].body},get bodyUsed(){return this[L].disturbed},arrayBuffer(){return q.call(this).then((function(t){return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}))},blob(){let t=this.headers&&this.headers.get("content-type")||"";return q.call(this).then((function(e){return Object.assign(new z([],{type:t.toLowerCase()}),{[O]:e})}))},json(){var t=this;return q.call(this).then((function(e){try{return JSON.parse(e.toString())}catch(e){return N.Promise.reject(new I(`invalid json response body at ${t.url} reason: ${e.message}`,"invalid-json"))}}))},text(){return q.call(this).then((function(t){return t.toString()}))},buffer(){return q.call(this)},textConverted(){var t=this;return q.call(this).then((function(e){return function(t,e){if("function"!=typeof R)throw new Error("The package `encoding` must be installed to use the textConverted() function");const r=e.get("content-type");let n,i,o="utf-8";r&&(n=/charset=([^;]*)/i.exec(r));i=t.slice(0,1024).toString(),!n&&i&&(n=/<meta.+?charset=(['"])(.+?)\1/i.exec(i));!n&&i&&(n=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(i),n&&(n=/charset=(.*)/i.exec(n.pop())));!n&&i&&(n=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(i));n&&(o=n.pop(),"gb2312"!==o&&"gbk"!==o||(o="gb18030"));return R(t,"UTF-8",o).toString()}(e,t.headers)}))}},Object.defineProperties(N.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),N.mixIn=function(t){for(const e of Object.getOwnPropertyNames(N.prototype))if(!(e in t)){const r=Object.getOwnPropertyDescriptor(N.prototype,e);Object.defineProperty(t,e,r)}},N.Promise=global.Promise;const W=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,J=/[^\t\x20-\x7e\x80-\xff]/;function X(t){if(t=`${t}`,W.test(t)||""===t)throw new TypeError(`${t} is not a legal HTTP header name`)}function Q(t){if(t=`${t}`,J.test(t))throw new TypeError(`${t} is not a legal HTTP header value`)}function Z(t,e){e=e.toLowerCase();for(const r in t)if(r.toLowerCase()===e)return r}const K=Symbol("map");class Y{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[K]=Object.create(null),t instanceof Y){const e=t.raw(),r=Object.keys(e);for(const t of r)for(const r of e[t])this.append(t,r)}else if(null==t);else{if("object"!=typeof t)throw new TypeError("Provided initializer must be an object");{const e=t[Symbol.iterator];if(null!=e){if("function"!=typeof e)throw new TypeError("Header pairs must be iterable");const r=[];for(const e of t){if("object"!=typeof e||"function"!=typeof e[Symbol.iterator])throw new TypeError("Each header pair must be iterable");r.push(Array.from(e))}for(const t of r){if(2!==t.length)throw new TypeError("Each header pair must be a name/value tuple");this.append(t[0],t[1])}}else for(const e of Object.keys(t)){const r=t[e];this.append(e,r)}}}}get(t){X(t=`${t}`);const e=Z(this[K],t);return void 0===e?null:this[K][e].join(", ")}forEach(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=tt(this),n=0;for(;n<r.length;){var i=r[n];const o=i[0],s=i[1];t.call(e,s,o,this),r=tt(this),n++}}set(t,e){e=`${e}`,X(t=`${t}`),Q(e);const r=Z(this[K],t);this[K][void 0!==r?r:t]=[e]}append(t,e){e=`${e}`,X(t=`${t}`),Q(e);const r=Z(this[K],t);void 0!==r?this[K][r].push(e):this[K][t]=[e]}has(t){return X(t=`${t}`),void 0!==Z(this[K],t)}delete(t){X(t=`${t}`);const e=Z(this[K],t);void 0!==e&&delete this[K][e]}raw(){return this[K]}keys(){return rt(this,"key")}values(){return rt(this,"value")}[Symbol.iterator](){return rt(this,"key+value")}}function tt(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";const r=Object.keys(t[K]).sort();return r.map("key"===e?function(t){return t.toLowerCase()}:"value"===e?function(e){return t[K][e].join(", ")}:function(e){return[e.toLowerCase(),t[K][e].join(", ")]})}Y.prototype.entries=Y.prototype[Symbol.iterator],Object.defineProperty(Y.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(Y.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});const et=Symbol("internal");function rt(t,e){const r=Object.create(nt);return r[et]={target:t,kind:e,index:0},r}const nt=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==nt)throw new TypeError("Value of `this` is not a HeadersIterator");var t=this[et];const e=t.target,r=t.kind,n=t.index,i=tt(e,r);return n>=i.length?{value:void 0,done:!0}:(this[et].index=n+1,{value:i[n],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));function it(t){const e=Object.assign({__proto__:null},t[K]),r=Z(t[K],"Host");return void 0!==r&&(e[r]=e[r][0]),e}Object.defineProperty(nt,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});const ot=Symbol("Response internals"),st=r.STATUS_CODES;class at{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};N.call(this,t,e);const r=e.status||200,n=new Y(e.headers);if(null!=t&&!n.has("Content-Type")){const e=F(t);e&&n.append("Content-Type",e)}this[ot]={url:e.url,status:r,statusText:e.statusText||st[r],headers:n,counter:e.counter}}get url(){return this[ot].url||""}get status(){return this[ot].status}get ok(){return this[ot].status>=200&&this[ot].status<300}get redirected(){return this[ot].counter>0}get statusText(){return this[ot].statusText}get headers(){return this[ot].headers}clone(){return new at(H(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}}N.mixIn(at.prototype),Object.defineProperties(at.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(at.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});const ut=Symbol("Request internals"),lt=n.parse,ct=n.format,_t="destroy"in e.Readable.prototype;function ht(t){return"object"==typeof t&&"object"==typeof t[ut]}class ft{constructor(t){let e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};ht(t)?e=lt(t.url):(e=t&&t.href?lt(t.href):lt(`${t}`),t={});let n=r.method||t.method||"GET";if(n=n.toUpperCase(),(null!=r.body||ht(t)&&null!==t.body)&&("GET"===n||"HEAD"===n))throw new TypeError("Request with GET/HEAD method cannot have body");let i=null!=r.body?r.body:ht(t)&&null!==t.body?H(t):null;N.call(this,i,{timeout:r.timeout||t.timeout||0,size:r.size||t.size||0});const o=new Y(r.headers||t.headers||{});if(null!=i&&!o.has("Content-Type")){const t=F(i);t&&o.append("Content-Type",t)}let s=ht(t)?t.signal:null;if("signal"in r&&(s=r.signal),null!=s&&!function(t){const e=t&&"object"==typeof t&&Object.getPrototypeOf(t);return!(!e||"AbortSignal"!==e.constructor.name)}(s))throw new TypeError("Expected signal to be an instanceof AbortSignal");this[ut]={method:n,redirect:r.redirect||t.redirect||"follow",headers:o,parsedURL:e,signal:s},this.follow=void 0!==r.follow?r.follow:void 0!==t.follow?t.follow:20,this.compress=void 0!==r.compress?r.compress:void 0===t.compress||t.compress,this.counter=r.counter||t.counter||0,this.agent=r.agent||t.agent}get method(){return this[ut].method}get url(){return ct(this[ut].parsedURL)}get headers(){return this[ut].headers}get redirect(){return this[ut].redirect}get signal(){return this[ut].signal}clone(){return new ft(this)}}function gt(t){Error.call(this,t),this.type="aborted",this.message=t,Error.captureStackTrace(this,this.constructor)}N.mixIn(ft.prototype),Object.defineProperty(ft.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(ft.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),gt.prototype=Object.create(Error.prototype),gt.prototype.constructor=gt,gt.prototype.name="AbortError";const dt=e.PassThrough,pt=n.resolve;function bt(t,n){if(!bt.Promise)throw new Error("native promise missing, set fetch.Promise to your favorite alternative");return N.Promise=bt.Promise,new bt.Promise((function(s,a){const u=new ft(t,n),l=function(t){const r=t[ut].parsedURL,n=new Y(t[ut].headers);if(n.has("Accept")||n.set("Accept","*/*"),!r.protocol||!r.hostname)throw new TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(r.protocol))throw new TypeError("Only HTTP(S) protocols are supported");if(t.signal&&t.body instanceof e.Readable&&!_t)throw new Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let i=null;if(null==t.body&&/^(POST|PUT)$/i.test(t.method)&&(i="0"),null!=t.body){const e=G(t);"number"==typeof e&&(i=String(e))}i&&n.set("Content-Length",i),n.has("User-Agent")||n.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),t.compress&&!n.has("Accept-Encoding")&&n.set("Accept-Encoding","gzip,deflate");let o=t.agent;return"function"==typeof o&&(o=o(r)),n.has("Connection")||o||n.set("Connection","close"),Object.assign({},r,{method:t.method,headers:it(n),agent:o})}(u),c=("https:"===l.protocol?i:r).request,_=u.signal;let h=null;const f=function(){let t=new gt("The user aborted a request.");a(t),u.body&&u.body instanceof e.Readable&&u.body.destroy(t),h&&h.body&&h.body.emit("error",t)};if(_&&_.aborted)return void f();const g=function(){f(),b()},d=c(l);let p;function b(){d.abort(),_&&_.removeEventListener("abort",g),clearTimeout(p)}_&&_.addEventListener("abort",g),u.timeout&&d.once("socket",(function(t){p=setTimeout((function(){a(new I(`network timeout at: ${u.url}`,"request-timeout")),b()}),u.timeout)})),d.on("error",(function(t){a(new I(`request to ${u.url} failed, reason: ${t.message}`,"system",t)),b()})),d.on("response",(function(t){clearTimeout(p);const e=function(t){const e=new Y;for(const r of Object.keys(t))if(!W.test(r))if(Array.isArray(t[r]))for(const n of t[r])J.test(n)||(void 0===e[K][r]?e[K][r]=[n]:e[K][r].push(n));else J.test(t[r])||(e[K][r]=[t[r]]);return e}(t.headers);if(bt.isRedirect(t.statusCode)){const r=e.get("Location"),n=null===r?null:pt(u.url,r);switch(u.redirect){case"error":return a(new I(`redirect mode is set to error: ${u.url}`,"no-redirect")),void b();case"manual":if(null!==n)try{e.set("Location",n)}catch(t){a(t)}break;case"follow":if(null===n)break;if(u.counter>=u.follow)return a(new I(`maximum redirect reached at: ${u.url}`,"max-redirect")),void b();const r={headers:new Y(u.headers),follow:u.follow,counter:u.counter+1,agent:u.agent,compress:u.compress,method:u.method,body:u.body,signal:u.signal,timeout:u.timeout};return 303!==t.statusCode&&u.body&&null===G(u)?(a(new I("Cannot follow redirect with body being a readable stream","unsupported-redirect")),void b()):(303!==t.statusCode&&(301!==t.statusCode&&302!==t.statusCode||"POST"!==u.method)||(r.method="GET",r.body=void 0,r.headers.delete("content-length")),s(bt(new ft(n,r))),void b())}}t.once("end",(function(){_&&_.removeEventListener("abort",g)}));let r=t.pipe(new dt);const n={url:u.url,status:t.statusCode,statusText:t.statusMessage,headers:e,size:u.size,timeout:u.timeout,counter:u.counter},i=e.get("Content-Encoding");if(!u.compress||"HEAD"===u.method||null===i||204===t.statusCode||304===t.statusCode)return h=new at(r,n),void s(h);const l={flush:o.Z_SYNC_FLUSH,finishFlush:o.Z_SYNC_FLUSH};if("gzip"==i||"x-gzip"==i)return r=r.pipe(o.createGunzip(l)),h=new at(r,n),void s(h);if("deflate"!=i&&"x-deflate"!=i){if("br"==i&&"function"==typeof o.createBrotliDecompress)return r=r.pipe(o.createBrotliDecompress()),h=new at(r,n),void s(h);h=new at(r,n),s(h)}else{t.pipe(new dt).once("data",(function(t){r=8==(15&t[0])?r.pipe(o.createInflate()):r.pipe(o.createInflateRaw()),h=new at(r,n),s(h)}))}})),function(t,e){const r=e.body;null===r?t.end():V(r)?r.stream().pipe(t):Buffer.isBuffer(r)?(t.write(r),t.end()):r.pipe(t)}(d,u)}))}bt.isRedirect=function(t){return 301===t||302===t||303===t||307===t||308===t},bt.Promise=global.Promise;var mt,yt=(mt=Object.freeze({__proto__:null,default:bt,Headers:Y,Request:ft,Response:at,FetchError:I}))&&mt.default||mt,wt=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t,e){var r=yt.default||yt,n=function(t,e){return/^\/\//.test(t)&&(t="https:"+t),r.call(this,t,e)};t.exports=e=n,e.fetch=n,e.Headers=yt.Headers,e.Request=yt.Request,e.Response=yt.Response,e.default=n}));wt.fetch,wt.Headers,wt.Request,wt.Response;const vt={get:(t,e,r)=>"send"===e?async()=>{const e=await wt(t.uri,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.payload)});return await e.json()}:(...n)=>{const i=t.id;return t.id=t.id+1,t.payload.push({jsonrpc:"2.0",id:i,method:e,params:n}),r}},Bt={get:(t,e)=>"batch"===e?()=>new Proxy({id:Math.round(1e7*Math.random()),payload:[],uri:t.uri},vt):async(...r)=>{const n=Math.round(1e7*Math.random()),i=await wt(t.uri,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:n,method:e,params:r})}),o=await i.json();if(o.id!==n)throw new Error("JSONRPCError: response ID does not match request ID!");if(o.error)throw new Error(`JSONRPCError: server error ${JSON.stringify(o.error)}`);return o.result}};class Pt{constructor(t){return this.uri=t,new Proxy(this,Bt)}static create(t){return new Pt(t)}}function Dt(t){return l.BigInt(t)}function St(t){return"0x"+t.toString(16)}function Tt(t){return function(e,r){if(!(r instanceof ArrayBuffer)){let n=St(l.BigInt(r)).substr(2);if(n.length%2!=0&&(n="0"+n),n.length/2>t)throw new Error(`${e} is ${n.length/2} bytes long, expected length is ${t}!`);const i=new DataView(new ArrayBuffer(t));for(let t=0;t<n.length/2;t++){const e=n.length-2*(t+1);i.setUint8(t,parseInt(n.substr(e,2),16))}r=i.buffer}if(r.byteLength<t){const e=new Uint8Array(t);e.set(new Uint8Array(r),0),r=e.buffer}return r}}function $t(t){return function(e,r){if(r=new u(r).toArrayBuffer(),t>0&&r.byteLength!==t)throw new Error(`${e} has invalid length ${r.byteLength}, required: ${t}`);return r}}function kt(t,e,r){const n={};for(const[i,o]of Object.entries(r)){const r=e[i];if(!r)throw new Error(`${t} is missing ${i}!`);n[i]=o(`${t}.${i}`,r)}return n}function xt(t,{debugPath:e="script"}={}){return kt(e,t,{code_hash:$t(32),hash_type:function(t,e){switch(e){case"data":return 0;case"type":return 1;case 0:case 1:return e;default:throw new Error(`${t}.hash_type has invalid value: ${e}`)}},args:$t(-1)})}function Ct(t,{debugPath:e="out_point"}={}){return kt(e,t,{tx_hash:$t(32),index:Tt(4)})}function Et(t){return function(e,r){return t(r,{debugPath:e})}}function At(t,{debugPath:e="cell_input"}={}){return kt(e,t,{since:Tt(8),previous_output:Et(Ct)})}function Ot(t,{debugPath:e="cell_output"}={}){const r=kt(e,t,{capacity:Tt(8),lock:Et(xt)});return t.type&&(r.type_=xt(t.type,{debugPath:`${e}.type`})),r}function jt(t,{debugPath:e="cell_dep"}={}){return kt(e,t,{out_point:Et(Ct),dep_type:function(t,e){switch(e){case"code":return 0;case"dep_group":return 1;case 0:case 1:return e;default:throw new Error(`${t}.dep_type has invalid value: ${e}`)}}})}function zt(t){return function(e,r){return r.map((r,n)=>t(`${e}[${n}]`,r))}}function It(t,{debugPath:e="raw_transaction"}={}){return kt(e,t,{version:Tt(4),cell_deps:zt(Et(jt)),header_deps:zt($t(32)),inputs:zt(Et(At)),outputs:zt(Et(Ot)),outputs_data:zt($t(-1))})}function Rt(t,{debugPath:e="transaction"}={}){const r=It(t,{debugPath:`(raw)${e}`}),n=kt(e,t,{witnesses:zt($t(-1))});return n.raw=r,n}function Lt(t,{debugPath:e="raw_header"}={}){return kt(e,t,{version:Tt(4),compact_target:Tt(4),timestamp:Tt(8),number:Tt(8),epoch:Tt(8),parent_hash:$t(32),transactions_root:$t(32),proposals_hash:$t(32),uncles_hash:$t(32),dao:$t(32)})}function Mt(t,{debugPath:e="header"}={}){const r=Lt(t,{debugPath:`(raw)${e}`}),n=kt(e,t,{nonce:Tt(16)});return n.raw=r,n}function Nt(t,{debugPath:e="uncle_block"}={}){return kt(e,t,{header:Et(Mt),proposals:zt($t(10))})}var qt=Object.freeze({__proto__:null,NormalizeScript:xt,NormalizeOutPoint:Ct,NormalizeCellInput:At,NormalizeCellOutput:Ot,NormalizeCellDep:jt,NormalizeRawTransaction:It,NormalizeTransaction:Rt,NormalizeRawHeader:Lt,NormalizeHeader:Mt,NormalizeUncleBlock:Nt,NormalizeBlock:function(t,{debugPath:e="block"}={}){return kt(e,t,{header:Et(Mt),uncles:zt(Et(Nt)),transactions:zt(Et(Rt)),proposals:zt($t(10))})},NormalizeCellbaseWitness:function(t,{debugPath:e="cellbase_witness"}={}){return kt(e,t,{lock:Et(xt),message:$t(-1)})},NormalizeWitnessArgs:function(t,{debugPath:e="witness_args"}={}){const r={};return t.lock&&(r.lock=$t(-1)(`${e}.lock`,t.lock)),t.input_type&&(r.input_type=$t(-1)(`${e}.input_type`,t.input_type)),t.output_type&&(r.output_type=$t(-1)(`${e}.output_type`,t.output_type)),r}});function Ut(t,e){return e instanceof Object&&e.serializeJson instanceof Function?e.serializeJson.call(e):e}function Vt(t,e,r){if(!((e=Ut(0,e))instanceof Object))throw new Error(`Transformed ${t} is not an object!`);const n={};for(const[i,o]of Object.entries(r)){let r=e[i];if(!r){r=e[i.replace(/(_[a-z])/g,t=>t.toUpperCase().replace("_",""))]}r&&(n[i]=o(`${t}.${i}`,r))}return n}function Ht(t,{validation:e=!0,debugPath:r="script"}={}){return t=Vt(r,t,{code_hash:Ut,hash_type:Ut,args:Ut}),e&&g(t,{debugPath:`(transformed) ${r}`}),t}function Ft(t,{validation:e=!0,debugPath:r="out_point"}={}){return t=Vt(r,t,{tx_hash:Ut,index:Ut}),e&&d(t,{debugPath:`(transformed) ${r}`}),t}function Gt(t){return function(e,r){return t(r,{validation:!1,debugPath:e})}}function Wt(t,{validation:e=!0,debugPath:r="cell_input"}={}){return t=Vt(r,t,{since:Ut,previous_output:Gt(Ft)}),e&&p(t,{debugPath:`(transformed) ${r}`}),t}function Jt(t,{validation:e=!0,debugPath:r="cell_output"}={}){return t=Vt(r,t,{capacity:Ut,lock:Gt(Ht),type:Gt(Ht)}),e&&b(t,{debugPath:`(transformed) ${r}`}),t}function Xt(t,{validation:e=!0,debugPath:r="cell_dep"}={}){return t=Vt(r,t,{out_point:Gt(Ft),dep_type:Ut}),e&&m(t,{debugPath:`(transformed) ${r}`}),t}function Qt(t){return function(e,r){return r.map((r,n)=>t(`${e}[${n}]`,r))}}function Zt(t,{validation:e=!0,debugPath:r="transaction"}={}){return t=Vt(r,t,{version:Ut,cell_deps:Qt(Gt(Xt)),header_deps:Qt(Ut),inputs:Qt(Gt(Wt)),outputs:Qt(Gt(Jt)),outputs_data:Qt(Ut),witnesses:Qt(Ut)}),e&&P(t,{debugPath:`(transformed) ${r}`}),t}function Kt(t,{validation:e=!0,debugPath:r="header"}={}){return t=Vt(r,t,{version:Ut,compact_target:Ut,timestamp:Ut,number:Ut,epoch:Ut,parent_hash:Ut,transactions_root:Ut,proposals_hash:Ut,uncles_hash:Ut,dao:Ut,nonce:Ut}),e&&S(t,{debugPath:`(transformed) ${r}`}),t}function Yt(t,{validation:e=!0,debugPath:r="uncle_block"}={}){return t=Vt(r,t,{header:Gt(Kt),proposals:Qt(Ut)}),e&&$(t,{debugPath:`(transformed) ${r}`}),t}var te=Object.freeze({__proto__:null,TransformScript:Ht,TransformOutPoint:Ft,TransformCellInput:Wt,TransformCellOutput:Jt,TransformCellDep:Xt,TransformRawTransaction:function(t,{validation:e=!0,debugPath:r="raw_transaction"}={}){return t=Vt(r,t,{version:Ut,cell_deps:Qt(Gt(Xt)),header_deps:Qt(Ut),inputs:Qt(Gt(Wt)),outputs:Qt(Gt(Jt)),outputs_data:Qt(Ut)}),e&&B(t,{debugPath:`(transformed) ${r}`}),t},TransformTransaction:Zt,TransformRawHeader:function(t,{validation:e=!0,debugPath:r="raw_header"}={}){return t=Vt(r,t,{version:Ut,compact_target:Ut,timestamp:Ut,number:Ut,epoch:Ut,parent_hash:Ut,transactions_root:Ut,proposals_hash:Ut,uncles_hash:Ut,dao:Ut}),e&&D(t,{debugPath:`(transformed) ${r}`}),t},TransformHeader:Kt,TransformUncleBlock:Yt,TransformBlock:function(t,{validation:e=!0,debugPath:r="block"}={}){return t=Vt(r,t,{header:Gt(Kt),uncles:Qt(Gt(Yt)),transactions:Qt(Gt(Zt)),proposals:Qt(Ut)}),e&&k(t,{debugPath:`(transformed) ${r}`}),t},TransformCellbaseWitness:function(t,{validation:e=!0,debugPath:r="cellbase_witness"}={}){return t=Vt(r,t,{lock:Gt(Ht),message:Ut}),e&&x(t,{debugPath:`(transformed) ${r}`}),t},TransformWitnessArgs:function(t,{validation:e=!0,debugPath:r="witness_args"}={}){return t=Vt(r,t,{lock:Ut,input_type:Ut,output_type:Ut}),e&&C(t,{debugPath:`(transformed) ${r}`}),t}});var ee=Object.freeze({__proto__:null,RPCCollector:class{constructor(t,e,{skipCellWithContent:r=!0,loadData:n=!1}={}){this.rpc=t,this.lockHash=new u(e).serializeJson(),this.skipCellWithContent=r,this.loadData=n}async*collect(){const t=Dt(await this.rpc.get_tip_block_number());let e=l.BigInt(0);for(;l.lessThanOrEqual(e,t);){let r=l.add(e,l.BigInt(100));l.greaterThan(r,t)&&(r=t);const n=await this.rpc.get_cells_by_lock_hash(this.lockHash,St(e),St(r));for(const t of n)if(this.skipCellWithContent){if(t.type||l.greaterThan(Dt(t.output_data_len),l.BigInt(100)))continue;let e=null;if(this.loadData){e=(await this.rpc.get_live_cell(t.out_point,!0)).cell.data.content}yield{cell_output:{capacity:t.capacity,lock:t.lock,type:t.type},out_point:t.out_point,block_hash:t.block_hash,data:e}}e=l.add(r,l.BigInt(1))}}}});exports.BigIntToHexString=St,exports.HexStringToBigInt=Dt,exports.RPC=Pt,exports.Reader=u,exports.TransactionDumper=class{constructor(t,{validateTransaction:e=!0,depGroupUnpacker:r=null}={}){this.rpc=t,this.validateTransaction=e,this.depGroupUnpacker=r}async dumpByHash(t){const e=(await this.rpc.get_transaction(t)).transaction;return delete e.hash,await this.dump(e)}async dump(t){this.validateTransaction&&P(t);const e=[];for(const r of t.inputs){const{output:t,data:n,header:i}=await this._resolveOutPoint(r.previous_output);e.push({input:r,output:t,data:n,header:i})}const r=[];for(const e of t.cell_deps){const{output:t,data:n,header:i}=await this._resolveOutPoint(e.out_point);if(r.push({cell_dep:e,output:t,data:n,header:i}),"dep_group"===e.dep_type){if(!this.depGroupUnpacker)throw new Error("depGroupUnpacker must be provided when the transaction contains dep_group!");const t=this.depGroupUnpacker(new u(n));for(const e of t){d(e);const{output:t,data:n,header:i}=await this._resolveOutPoint(e);r.push({cell_dep:{out_point:e,dep_type:"code"},output:t,data:n,header:i})}}}const n=[];for(const e of t.header_deps)n.push(await this.rpc.get_header(e));return JSON.stringify({mock_info:{inputs:e,cell_deps:r,header_deps:n},tx:t})}async _resolveOutPoint(t){const e=await this.rpc.get_transaction(t.tx_hash);if(!e||!e.transaction)throw new Error(`Transaction ${t.tx_hash} cannot be found!`);const r=e.transaction,n=l.toNumber(l.BigInt(t.index));if(n>=r.outputs.length)throw new Error(`Transaction ${t.tx_hash} does not have output ${n}!`);const i={output:r.outputs[n],data:r.outputs_data[n]};return"committed"===e.tx_status.status&&(i.header=e.tx_status.block_hash),i}},exports.VERSION="0.9.1",exports.cell_collectors=ee,exports.normalizers=qt,exports.transformers=te,exports.validators=E;
//# sourceMappingURL=ckb-js-toolkit.node.js.map
